{% extends 'root/base.html' %}
{% load static %}
{% block maincontent %}

{% include 'root/loader.html' %}

<script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>

<div class="container-fluid">
    <div class="configuration-table_wrapper">
        <div class="elements-space-between">
            <h3>Maintain Suppliers</h3>
            <div>
                <button class="btn btn-outline-primary modal_upload" id="id_upload_redirect_data"
                    value="supplier_upload" onclick="onclick_upload_button()" type="button">
                    <i class="fas fa-cloud-upload-alt"></i> UPLOAD DATA
                </button>
                  <button class="btn btn-outline-secondary" id="id_close" value="close" title="Close"  onclick="window_close();">
                    <i class="fas fa-times"></i> close
                </button>
            </div>
        </div>

        <hr>

        <div class="configuration-table_section">
            <div id="err_msg_app_settings"> </div>
            <div id="err_msg_app_settings_t" class="alert alert-success" hidden></div>

            <div class="table-container">
                <table id="display_basic_table" class="class_basic_supplier_table table table-bordered custom-table">
                    <thead id="id_supplier_table_header">
                        <tr>
                            <th id="hg_select_checkbox" hidden>Select</th>
                            <th>Supplier Id</th>
                            <th>Supp Type</th>
                            <th>Name1</th>
                            <th>Name2</th>
                            <th>City</th>
                            <th>Postal_code</th>
                            <th>street</th>
                            <th>landline</th>
                            <th>mobile_num</th>
                            <th hidden>fax</th>
                            <th>email</th>
                            <th hidden>email1</th>
                            <th hidden>email2</th>
                            <th hidden>email3</th>
                            <th hidden>email4</th>
                            <th hidden>email5</th>
                            <th hidden>output_medium</th>
                            <th hidden>search_term1</th>
                            <th hidden>search_term2</th>
                            <th hidden>duns_number</th>
                            <th hidden>block_date</th>
                            <th hidden>block</th>
                            <th hidden>working_days</th>
                            <th hidden>is_active</th>
                            <th hidden>registration_number</th>
                            <th hidden>country_code</th>
                            <th hidden>currency_id</th>
                            <th hidden>language_id</th>
                            <th hidden>Guid</th>
                        </tr>
                    </thead>
                    <tbody id="id_supplier_tbody">
                        {% for supplier in supplier_data %}
                        <tr>
                            <td class="class_select_checkbox" hidden>
                                <input type="checkbox" class="checkbox_check" onclick="valueChanged()" required>
                            </td>
                            <td>{{ supplier.supplier_id}}</td>
                            <td>{{supplier.supp_type}}</td>
                            <td>{{supplier.name1}}</td>
                            <td>{{supplier.name2}}</td>
                            <td>{{supplier.city}}</td>
                            <td>{{supplier.postal_code}}</td>
                            <td>{{supplier.street}}</td>
                            <td>{{supplier.landline}}</td>
                            <td>{{supplier.mobile_num}}</td>
                            <td hidden>{{supplier.fax}}</td>
                            <td>{{supplier.email}}</td>
                            <td hidden>{{supplier.email1}}</td>
                            <td hidden>{{supplier.email2}}</td>
                            <td hidden>{{supplier.email3}}</td>
                            <td hidden>{{supplier.email4}}</td>
                            <td hidden>{{supplier.email5}}</td>
                            <td hidden>{{supplier.output_medium}}</td>
                            <td hidden>{{supplier.search_term1}}</td>
                            <td hidden>{{supplier.search_term2}}</td>
                            <td hidden>{{supplier.duns_number}}</td>
                            <td hidden>{{supplier.block_date}}</td>
                            <td hidden>{{supplier.block}}</td>
                            <td hidden>{{supplier.delivery_days}}</td>
                            <td hidden>{{supplier.is_active}}</td>
                            <td hidden>{{supplier.registration_number}}</td>
                            <td hidden>{{supplier.country_code}}</td>
                            <td hidden>{{supplier.currency_id}}</td>
                            <td hidden>{{supplier.language_id}}</td>

                            <td hidden>{{ supplier.supp_guid}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!--modal popup for Add,copy,update and upload-->

    <div class="modal fade" id="myModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"> Maintain Supplier</h5>
                    <button type="button" class="close remove_upload_data" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <!-- Modal body -->
                <div class="modal-body scrollbox">

                    <div id="id_del_add_button">
                        <button type="button" class="btn btn-primary" onclick="add_popup_row()"><i
                                class="fa fa-plus"></i> add new row </button>
                        <button class="btn btn-primary" onclick="application_settings_delete_Row('id_popup_table')"><i
                                class="fa fa-trash" aria-hidden="true" title="Delete Line"></i> delete</button>
                    </div>

                    <div id="id_check_success_messages" class="alert alert-success check_success_message" hidden></div>
                    <div id="id_check_error_messages" class="alert alert-danger check_error_messages" hidden></div>
                    <div id="id_check_special_character_messages"
                        class="alert alert-danger check_special_character_messages" hidden>
                        <p id="id_error_msg_supplier_id"></p>
                        <p id="id_error_msg_supp_email"></p>
                        <p id="id_error_msg_supplier_length"></p>
                    </div>
                    <div>
                        <p id="id_error_msg" class="alert alert-danger" hidden></p>
                    </div>

                    <table class="class_popup_table" id="id_popup_table">
                        <thead>
                            <tr>
                                <th>Select</th>
                                <th>Supplier Id</th>
                                <th>Supp Type</th>
                                <th>Name1</th>
                                <th>Name2</th>
                                <th>City</th>
                                <th>Postal_code</th>
                                <th>street</th>
                                <th>landline</th>
                                <th>mobile_num</th>
                                <th>fax</th>
                                <th>email</th>
                                <th>email1</th>
                                <th>email2</th>
                                <th>email3</th>
                                <th>email4</th>
                                <th>email5</th>
                                <th>output_medium</th>
                                <th>search_term1</th>
                                <th>search_term2</th>
                                <th>duns_number</th>
                                <th>block_date</th>
                                <th>block</th>
                                <th>working_days</th>
                                <th>is_active</th>
                                <th>registration_number</th>
                                <th>country_code</th>
                                <th>currency_id</th>
                                <th>language_id</th>
                                <th id="id_del_ind_checkbox" hidden>Del Indicator</th>
                                <th hidden>Guid</th>
                            </tr>
                        </thead>
                        <tbody id=id_popup_tbody>

                        </tbody>
                    </table>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button id="id_delete_duplicate" class="btn btn-primary" style="display:none;" type="button"
                        onclick="delete_duplicate()"><i class="fas fa-check"></i> delete duplicates</button>
                   <button id="id_check_data" style="display:none;" class="btn btn-primary " type="button" onclick="check_data()"><i class="fas fa-check"></i> check</button>
                    <button class="btn btn-primary" id="save_id"
                        onclick="document.getElementById('id_save_confirm_popup').style.display='block'; document.getElementById('myModal').style.display='none'"><i
                            class="fas fa-save"></i> save</button>
                    <button type="button" class="btn btn-primary remove_upload_data" data-dismiss="modal"><i
                            class="fas fa-times"></i> cancel</button>
                </div>
            </div>
        </div>
    </div>
    <!--end of modal popup for Add,copy,update and upload-->

    <!-- modal popup to upload the csv file; save confirmation popup; delete confirmation popup -->
    {% include 'configuration_common_pop_up.html' %}


    <div>
        {% if messages %}
        {% for message in messages %}
        {% if message.tags == 'success' %}
        <div style="color: green; ">{{ message }}</div>
        {% endif %}
        {% if message.tags == 'error' %}
        <div style="color: red; ">{{ message }}</div>
        {% endif %}
        {% if message.tags == 'info' %}
        <div style="color: Black bold"><b>{{ message }}</b> </div>
        {% endif %}
        {% endfor %}
        {% endif %}
    </div>
</div>
<script>

    var supplier_data_json = {{ supplier_data_json| safe}};
    var rendered_supp_data = JSON.stringify(supplier_data_json);
    var supplier_data_array = {}
    var main_table_supplier_value = [];
    var supplier = '';
    var edit_basic_data = '';
    var GLOBAL_ACTION = '';
    var no_duplicate_entries = 'Y'
    var no_duplicate_email = 'Y'
    var Tablename = uiConstants["CONST_TABLENAME_SUPPLIERMASTER"]
    var appname = uiConstants["CONST_APPNAME03"]
    var db_header_data = uiConstants["CONST_HEADER_DATA_SUPPLIERMASTER"]



    //onclick of data Upload copy data to modal pop-up
    function onclick_display_csv_data() {
           $("#error_msg_id").css("display", "none")
        formdata = new FormData();
        formdata.append("file_attach", $('#id_file_data_upload').prop('files')[0]);
        formdata.append("Tablename", uiConstants["CONST_TABLENAME_SUPPLIERMASTER"]);
        formdata.append("appname", uiConstants["CONST_APPNAME03"]);
        db_header_data = uiConstants["CONST_HEADER_DATA_SUPPLIERMASTER"]
        formdata.append("db_header_data", uiConstants["CONST_HEADER_DATA_SUPPLIERMASTER"]);
        $('#id_data_upload').modal('hide');
        OpenLoaderPopup();
        $.ajax({
            type: 'POST',
            url: "{% url 'eProc_Basic_Settings:data_upload' %}",
            data: formdata,
            contentType: "application/json; charset=utf-8",
            success: function (response) {
                if (response == "Please check the uploaded csv file") {
                    $("#id_error_msg_upload").prop("hidden", false)
                    document.getElementById("id_error_msg_upload").innerHTML = response;
                    document.getElementById("id_error_msg_upload").style.color = "Red";
                    $('#id_data_upload').modal('show');
                }
                else {
                    supplier_data_array = response;

                    var edit_basic_data = '';
                    var del_ind = '';
                    $("#id_popup_tbody").empty();
                    $.each(response, function (i, value) {

                        del_ind = '<td>' + value[25] + '</td>'
                        if (value[25] == 1) {
                            del_ind = ' <input type="checkbox" value="' + value[25] + '" checked>'
                        }
                        else {
                            del_ind = '<input type="checkbox" value="' + value[25] + '" required>'
                        }
                        edit_basic_data += '<tr><td class="class_select_checkbox"><input type="checkbox" required></td>' +
                            '<td id="supplier_id"><input type="text"  value="' + value[0] + '"  onkeypress="return /[a-z]/i.test(event.key)" required></td>' +
                            '<td><input type="text" value="' + value[1] + '" maxlength="100" onkeypress="return /[a-z ]/i.test(event.key)"></td>' +
                            '<td><input type="text" value="' + value[2] + '" maxlength="100" onkeypress="return /[a-z ]/i.test(event.key)"></td>' +
                            '<td><input type="text" value="' + value[3] + '" maxlength="100" onkeypress="return /[a-z ]/i.test(event.key)"></td>' +
                            '<td><input type="text" value="' + value[4] + '" maxlength="100" onkeypress="return /[a-z ]/i.test(event.key)"></td>' +
                            '<td><input type="text" value="' + value[5] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[6] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[7] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[8] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[9] + '" maxlength="100" ></td>' +
                            '<td><input type="text" value="' + value[10] + '" maxlength="100"></td>' +
                            '<td><input id="email" type="text" value="' + value[11] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[12] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[13] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[14] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[15] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[16] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[17] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[18] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[19] + '" maxlength="100"></td>' +
                            '<td><input type="date" value="' + value[20] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[21] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[22] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[23] + '" maxlength="100"></td>' +
                            '<td><input id="reg_num" type="text" value="' + value[24] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[26] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[27] + '" maxlength="100"></td>' +
                            '<td><input type="text" value="' + value[28] + '" maxlength="100"></td>' +

                            '<td><input type="checkbox"></td>' +
                            '<td hidden><input type="text" value="' + value[30] + '"></td></tr>';
                    });
                    $('#id_popup_tbody').append(edit_basic_data);
                    $("#id_del_ind_checkbox").prop("hidden", false);
                    $(".class_del_checkbox").prop("hidden", false);
                    $('#myModal').modal('show');;
                    $('#id_data_upload').modal('hide');
                    document.getElementById("id_del_add_button").style.display = "block";
                    document.getElementById("id_check_data").style.display = "block";
                    $("#id_check_data").prop("hidden", false);
                    $("#save_id").prop("hidden", true);
                    table_sort_filter_popup_pagination('id_popup_table')
                }
                CloseLoaderPopup();
            },
            cache: false,
            processData: false,
            contentType: false,

        });
    }

    
    // validate and save for add,copy,update and upload data
    function popup_save_data() {
        $('#id_popup_table').DataTable().destroy();
        var Tabledata = { "Dbl_clck_tbl_id": 'SupplierMaster' };
        var supp_data = new Array();
        var main_table_low_value = [];
        var validate_add_attributes = [];
        var main_table_email_value = [];
        var main_table_reg_num = [];
        var validate_email_attributes = [];
        var bl_date;
        var guid = '';
        var supplier = {};
        $("#id_popup_table TBODY TR").each(function () {
            var row = $(this);
            supplier = {};

            supplier.supp_guid = row.find("TD").eq(31).find('input[type="text"]').val();
            if (supplier.supp_guid == undefined) {
                supplier.supp_guid = '';
            }
            supplier.del_ind = row.find("TD").eq(30).find('input[type="checkbox"]').is(':checked');

            supplier.supplier_id = row.find("TD").eq(1).find('input[type="text"]').val().toUpperCase();
            supplier.supp_type = row.find("TD").eq(2).find('input[type="text"]').val();
            supplier.name1 = row.find("TD").eq(3).find('input[type="text"]').val();
            supplier.name2 = row.find("TD").eq(4).find('input[type="text"]').val();
            supplier.city = row.find("TD").eq(5).find('input[type="text"]').val();
            supplier.postal_code = row.find("TD").eq(6).find('input[type="text"]').val();
            supplier.street = row.find("TD").eq(7).find('input[type="text"]').val();
            supplier.landline = row.find("TD").eq(8).find('input[type="text"]').val();
            supplier.mobile_num = row.find("TD").eq(9).find('input[type="text"]').val();
            supplier.fax = row.find("TD").eq(10).find('input[type="text"]').val();
            supplier.email = row.find("TD").eq(11).find('input[type="text"]').val();
            supplier.email1 = row.find("TD").eq(12).find('input[type="text"]').val();
            supplier.email2 = row.find("TD").eq(13).find('input[type="text"]').val();
            supplier.email3 = row.find("TD").eq(14).find('input[type="text"]').val();
            supplier.email4 = row.find("TD").eq(15).find('input[type="text"]').val();
            supplier.email5 = row.find("TD").eq(16).find('input[type="text"]').val();
            supplier.output_medium = row.find("TD").eq(17).find('input[type="text"]').val();
            supplier.search_term1 = row.find("TD").eq(18).find('input[type="text"]').val();
            supplier.search_term2 = row.find("TD").eq(19).find('input[type="text"]').val();
            supplier.duns_number = row.find("TD").eq(20).find('input[type="text"]').val();
            bl_date = row.find("TD").eq(21).find('input[type="date"]').val();
            supplier.block_date = formatDate(bl_date);

            supplier.block = row.find("TD").eq(22).find('input[type="text"]').val();
            supplier.working_days = row.find("TD").eq(23).find('input[type="text"]').val();
            supplier.is_active = row.find("TD").eq(24).find('input[type="text"]').val();
            supplier.registration_number = row.find("TD").eq(25).find('input[type="text"]').val();
            supplier.country_code = row.find("TD").eq(26).find('input[type="text"]').val().toUpperCase();
            supplier.currency_id = row.find("TD").eq(27).find('input[type="text"]').val().toUpperCase();
            supplier.language_id = row.find("TD").eq(28).find('input[type="text"]').val().toUpperCase();

            if (supplier == undefined) {
                supplier.supplier_id = row.find("TD").eq(1).find('input[type="text"]').val();
            }

            validate_add_attributes.push(supplier.supplier_id);
            validate_email_attributes.push(supplier.email, supplier.registration_number);
            supp_data.push(supplier);
        });
        $('#display_basic_table').DataTable().destroy();
        $("#display_basic_table TBODY TR").each(function () {
            var row = $(this);
            var main_attribute = {};
            main_attribute.supplier_id = row.find("TD").eq(1).html();
            main_table_low_value.push(main_attribute.supplier_id);

            var main_attribute_email = {};
            var main_attribute_reg_num = {};
            main_attribute_email.email = row.find("TD").eq(11).html();
            main_table_email_value.push(main_attribute_email.email);
            main_attribute_reg_num.registration_number = row.find("TD").eq(25).html();
            main_table_reg_num.push(main_attribute_reg_num.registration_number);
        });
        table_sort_filter('display_basic_table');
        $("#id_error_msg").empty();
        no_duplicate_email = maintable_validation_email(validate_email_attributes, main_table_email_value)
        no_duplicate_reg_num = maintable_validation_reg_num(validate_email_attributes, main_table_reg_num)
        no_duplicate_value = compare_table_for_duplicate_entries(validate_add_attributes, supplier)
        no_duplicate_entries = maintable_validation(validate_add_attributes, main_table_low_value)
        // }
        if ((no_duplicate_value == 'Y') && (no_duplicate_entries == 'Y') && (no_duplicate_email == 'Y') && (no_duplicate_regnum == 'Y')) {
            //$("#save_id").prop("hidden", false);
            var add_basic_data = '';
            var supplier_data_array = [];
            $("#id_popup_table tbody tr").each(function (index) {
                var row = $(this);
                var supplier_object = {};
                supplier_object.supplier_id = (row.find("TD").eq(1).find('input[type="text"]').val())
                supplier_object.supp_type = (row.find("TD").eq(2).find('input[type="text"]').val())
                supplier_object.name1 = row.find("TD").eq(3).find('input[type="text"]').val();
                supplier_object.name2 = row.find("TD").eq(4).find('input[type="text"]').val();
                supplier_object.city = row.find("TD").eq(5).find('input[type="text"]').val();
                supplier_object.postal_code = row.find("TD").eq(6).find('input[type="text"]').val();
                supplier_object.street = row.find("TD").eq(7).find('input[type="text"]').val();
                supplier_object.landline = row.find("TD").eq(8).find('input[type="text"]').val();
                supplier_object.mobile_num = row.find("TD").eq(9).find('input[type="text"]').val();
                supplier_object.fax = row.find("TD").eq(10).find('input[type="text"]').val();
                supplier_object.email = row.find("TD").eq(11).find('input[type="text"]').val();
                supplier_object.email1 = row.find("TD").eq(12).find('input[type="text"]').val();
                supplier_object.email2 = row.find("TD").eq(13).find('input[type="text"]').val();
                supplier_object.email3 = row.find("TD").eq(14).find('input[type="text"]').val();
                supplier_object.email4 = row.find("TD").eq(15).find('input[type="text"]').val();
                supplier_object.email5 = row.find("TD").eq(16).find('input[type="text"]').val();
                supplier_object.output_medium = row.find("TD").eq(17).find('input[type="text"]').val();
                supplier_object.search_term1 = row.find("TD").eq(18).find('input[type="text"]').val();
                supplier_object.search_term2 = row.find("TD").eq(19).find('input[type="text"]').val();
                supplier_object.duns_number = row.find("TD").eq(20).find('input[type="text"]').val();
                supplier_object.block_date = row.find("TD").eq(21).find('input[type="date"]').val();
                supplier_object.block = row.find("TD").eq(22).find('input[type="text"]').val();
                supplier_object.working_days = row.find("TD").eq(23).find('input[type="text"]').val();
                supplier_object.is_active = row.find("TD").eq(24).find('input[type="text"]').val();
                supplier_object.registration_number = row.find("TD").eq(25).find('input[type="text"]').val();
                supplier_object.country_code = row.find("TD").eq(26).find('input[type="text"]').val().toUpperCase();
                supplier_object.currency_id = row.find("TD").eq(27).find('input[type="text"]').val().toUpperCase();
                supplier_object.language_id = row.find("TD").eq(28).find('input[type="text"]').val().toUpperCase();

                supplier_object.del_ind = row.find("TD").eq(30).find('input[type="checkbox"]').is(':checked');
                guid = row.find("TD").eq(31).find('input[type="text"]').val();
                if (guid == undefined) {
                    guid = '';
                }
                supplier_object.supp_guid = guid;
                supplier_data_array.push(supplier_object);
            });
            $('#id_save_confirm_popup').modal('hide');;
            OpenLoaderPopup()
            $.ajax({
                type: 'POST',
                url: "{% url 'eProc_Master_Settings:save_master_settings_data' %}",
                data: JSON.stringify($.extend({}, supplier_data_array, Tabledata)),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (Response) {
                    rendered_supp_data = Response[0];
                    display_basic_db_data();
                    $('#myModal').modal('hide');
                    $('#success_msg_id').text(Response[1])
                    if(Response[1].message_type== 'SUCCESS'){
                         $('#success_msg_id').text(Response[1].message_desc)
                    }
                    $("#err_msg_app_settings_t").prop("hidden", false)
                   table_sort_filter('id_popup_table');
                    setTimeout(function () { $("#err_msg_app_settings_t").prop("hidden", true); }, 5000)
                    table_sort_filter('id_popup_table');
                    CloseLoaderPopup();
                }
            });

        }
    }

//check function restricting special char and diaplay the data count of csv file
function check_data() {
    $('#id_popup_table').DataTable().destroy();
    $("#id_check_success_messages").empty()
    $("#id_check_error_messages").empty()
    $("#id_check_success_messages").prop("hidden",true)
    $("#id_check_error_messages").prop("hidden",true)
    $("#id_check_special_character_messages").prop("hidden",true)
    document.getElementById("id_error_msg_country_code").innerHTML = "";
    document.getElementById("id_error_msg_country_name").innerHTML = "";
    document.getElementById("id_error_msg_country_length").innerHTML = "";
    count = 0;
    var country_array = new Array
    var DB_array = new Array
    var country_list = new Array
    var country_code_check = new Array
    del_ind = ''
    $("#id_popup_table TBODY TR").each(function() {
        var row = $(this);

        //*************** reading data from the pop-up ***************
        country_name = row.find("TD").eq(2).find('input[type="text"]').val().toUpperCase();
        country_code = row.find("TD").eq(1).find('input[type="text"]').val().toUpperCase();
        checked_box = row.find("TD").eq(3).find('input[type="checkbox"]').is(':checked')
            if (checked_box){
                del_ind = '1'
            }
            else{
               del_ind = '0'
            }
        country_list.push([country_code, country_name, del_ind])

        var format = /[`!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?~]/;


            //*************** checking for max length for country code (max length = 2) ***************
            if(country_code.length >2){
               
                 var msg = "JMSG004";
                 var msg_type ;
                 msg_type = message_config_details(msg);
                 $("#error_msg_id").prop("hidden", false)
                 var display4 = msg_type.messages_id_desc;

                document.getElementById("id_error_msg_country_length").innerHTML = display4  + "Country Code";
                $(row.find("TD").eq(1).find('input[type="text"]')).css("border", "1px solid #FF0000");
                count = count +1;
            }

            //*************** checking for special characters for country code ***************
            else if(format.test(country_code)){
               
                 var msg = "JMSG003";
                 var msg_type ;
                 msg_type = message_config_details(msg);
                 $("#error_msg_id").prop("hidden", false)
                 var display4 = msg_type.messages_id_desc;
                document.getElementById("id_error_msg_country_code").innerHTML = display4 + "Country Code";
                $(row.find("TD").eq(1).find('input[type="text"]')).css("border", "1px solid #FF0000");
                count = count +1;
            }
            else{
            $(row.find("TD").eq(1).find('input[type="text"]')).css("border", "none");
            }

            //*************** checking for special characters for country name ***************
            if(format.test(country_name)){
               
                 var msg = "JMSG003";
                 var msg_type ;
                 msg_type = message_config_details(msg);
                 $("#error_msg_id").prop("hidden", false)
                 var display4 = msg_type.messages_id_desc;
                document.getElementById("id_error_msg_country_name").innerHTML = display4+ "Country Name";
                $(row.find("TD").eq(2).find('input[type="text"]')).css("border", "1px solid #FF0000");
                count = count +1;
           }
           else{
            $(row.find("TD").eq(2).find('input[type="text"]')).css("border", "none");
            }

           if(country_code_check.includes(country_code)){
                $(row).css("border", "#f8d7da");
                //$(row.find("TD").eq(1).find('input[type="text"]')).css("border", "1px solid #FF0000");
                //$(row.find("TD").eq(2).find('input[type="text"]')).css("border", "1px solid #FF0000");

            }
            else{
                $(row).css("border", "");
            }

            country_code_check.push(country_code)
    });

    //*************** shows save button if there are no errors(special characters and max length) ***************
    if(count == 0){
            $("#id_check_special_character_messages").prop("hidden",true)
             $("#save_id").prop("hidden", false);
    }
    popup_data_dict ={'data_list' : country_list, 'Tablename' : Tablename, 'appname' : appname, 'db_header_data' : ["COUNTRY_CODE", "COUNTRY_NAME", "del_ind"]}
    $.ajax({
        type: 'POST',
        url: "{% url 'eProc_Basic_Settings:check_data' %}",
        data: JSON.stringify(popup_data_dict),
        success: function(response) {
            //table_sort_filter_popup_pagination('id_popup_table')
            table_sort_filter('id_popup_table');
            $("#id_check_special_character_messages").prop("hidden",false)
            if(count == 0){
                $("#id_check_special_character_messages").prop("hidden",true)
            }

            //*************** retrieving data counts from views ***************
            check_messages = response
            var newArrayDataOfOjbect = Object.values(check_messages)
            $("#id_check_success_messages").prop("hidden",false)

                      //*************** if pop-up data count is greater than zero ***************
                    if (newArrayDataOfOjbect[1] > 0) {

                           
                             var msg = "JMSG010";
                             var msg_type ;
                             msg_type = message_config_details(msg);
                             $("#error_msg_id").prop("hidden", false)
                             var display = msg_type.messages_id_desc;

                        $("#id_check_success_messages").append('<p>' + display + newArrayDataOfOjbect[0] + '</p>')

                           
                             var msg = "JMSG011";
                             var msg_type ;
                             msg_type = message_config_details(msg);
                             $("#error_msg_id").prop("hidden", false)
                             var display1 = msg_type.messages_id_desc;

                        $("#id_check_success_messages").append('<p>' + display1 + newArrayDataOfOjbect[1] + '</p>')

                           
                             var msg = "JMSG012";
                             var msg_type ;
                             msg_type = message_config_details(msg);
                             $("#error_msg_id").prop("hidden", false)
                             var display2 = msg_type.messages_id_desc;
                        $("#id_check_success_messages").append('<p>' + display2 + newArrayDataOfOjbect[3] + '</p>')
                               
                                 var msg = "JMSG013";
                                 var msg_type ;
                                 msg_type = message_config_details(msg);
                                 $("#error_msg_id").prop("hidden", false)
                                 var display3 = msg_type.messages_id_desc;
                        $("#id_check_success_messages").append('<p>' + display3 + newArrayDataOfOjbect[4] + '</p>')
                               
                                 var msg = "JMSG014";
                                 var msg_type ;
                                 msg_type = message_config_details(msg);
                                 $("#error_msg_id").prop("hidden", false)
                                 var display4 = msg_type.messages_id_desc;
                        $("#id_check_success_messages").append('<p>' + display4 + newArrayDataOfOjbect[5] + '</p>')
                               
                                 var msg = "JMSG053";
                                 var msg_type ;
                                 msg_type = message_config_details(msg);
                                 $("#error_msg_id").prop("hidden", false)
                                 var display5 = msg_type.messages_id_desc;
	   				  $("#id_check_success_messages").append('<p>' + display5 + newArrayDataOfOjbect[6] + '</p>')
                         //*************** if duplicate data data count is greater than zero ***************
                        if(newArrayDataOfOjbect[2]>0){
                            $("#id_check_error_messages").prop("hidden",false)
                              
                                 var msg = "JMSG015";
                                 var msg_type ;
                                 msg_type = message_config_details(msg);
                                 $("#error_msg_id").prop("hidden", false)
                                 var display6 = msg_type.messages_id_desc;
                            $("#id_check_error_messages").append('<p>' + display6 + newArrayDataOfOjbect[2] + '</p>')
                               
                                 var msg = "JMSG001";
                                 var msg_type ;
                                 msg_type = message_config_details(msg);
                                 $("#error_msg_id").prop("hidden", false)
                                 var display7 = msg_type.messages_id_desc;
                            $("#id_check_error_messages").append('<p style = "font-weight: bold;">' + display7 + ' </p>')
                            $("#save_id").prop("hidden", true);
                            $("#id_delete_duplicate").show()
                        }
                        else{
                            $("#id_check_error_messages").prop("hidden",true)
                            $("#id_delete_duplicate").hide()
                        }
                    }
                    //*************** if pop-up data count is zero ***************
                    else {
                        $("#id_check_success_messages").hide()
                        $("#id_check_error_messages").prop("hidden", false)
                              
                                 var msg = "JMSG006";
                                 var msg_type ;
                                 msg_type = message_config_details(msg);
                                 $("#error_msg_id").prop("hidden", false)
                                 var display8 = msg_type.messages_id_desc;
                        $("#id_check_error_messages").append('<p>' + display8 + '</p>')
                        $("#save_id").prop("hidden", true);
            }
        }
    });
}

       function window_close() {
             window.history.back();
              var preUrl = document.referrer;
              console.log(preUrl);
              window.open('', '_self', '').close();
              if (preUrl == null)
                     return "The previous page url is empty";
               else
                     return preUrl;
       }

 // validating the  popup table for duplicate entries
function compare_table_for_duplicate_entries(validate_add_attributes, supplier) {
    add_attr_duplicates = false;
    var add_attr_duplicates_list = [];
    var add_attr_unique_list = [];
    var no_duplicate_value = 'Y'
    $.each(validate_add_attributes, function (index, value) {
        if ($.inArray(value, add_attr_unique_list) == -1) {
            add_attr_unique_list.push(value);
        }
        else {
            if ($.inArray(value, add_attr_duplicates_list) == -1) {
                add_attr_duplicates_list.push(value);
            }
        }
    });
    if (add_attr_duplicates_list.length != 0) {
        //document.getElementById("id_error_msg").innerHTML = messageConstants["JMSG001"];
           
                var msg = "JMSG001";
                var msg_type ;
              msg_type = message_config_details(msg);
              $("#error_msg_id").prop("hidden", false)

              if(msg_type.message_type == "ERROR"){
                    display_message("error_msg_id", msg_type.messages_id_desc)
              }
              else if(msg_type.message_type == "WARNING"){
                 display_message("id_warning_msg_id", msg_type.messages_id_desc)
              }
              else if(msg_type.message_type == "INFORMATION"){
                 display_message("id_info_msg_id", msg_type.messages_id_desc)
              }
                no_duplicate_value = 'N'
                return [no_duplicate_value,error_message]
            }
    else if (supplier.supplier_id.length == 0) {
             //Error_msg = messageConstants["JMSG002"] + "Supplier Id";
           
                var msg = "JMSG002";
                var msg_type ;
              msg_type = message_config_details(msg);
              $("#error_msg_id").prop("hidden", false)

              if(msg_type.message_type == "ERROR"){
                    display_message("error_msg_id", msg_type.messages_id_desc)
              }
              else if(msg_type.message_type == "WARNING"){
                 display_message("id_warning_msg_id", msg_type.messages_id_desc)
              }
              else if(msg_type.message_type == "INFORMATION"){
                 display_message("id_info_msg_id", msg_type.messages_id_desc)
              }
                no_duplicate_value = 'N'
                return [no_duplicate_value,error_message]
            }

                return no_duplicate_value
}
</script>

<script src="{% static 'scripts/supplier_managment/supplier_upload.js' %}"></script>

{% endblock %}